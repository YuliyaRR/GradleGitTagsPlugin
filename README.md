# GradleGitTagsPlugin
*Gradle API | Groovy | Git*

Плагин предоставляет возможность работать с версионностью проекта, присваивать новые теги и публиковать их в удаленном репозитории

## Запуск плагина

### Подготовка

1. Склонировать плагин командой
```
   git clone https://github.com/YuliyaRR/GradleGitTagsPlugin.git
```

3. Открыть плагин в IDE и во вкладке Gradle выбрать *publishing -> publishToMavenLocal*. После этого плагин будет доступен в локальном репозитории .m2

### Использование

1. В файле **settings.gradle** добавить следующий блок 
```
pluginManagement {
    repositories {
        mavenLocal()
        mavenCentral()
        gradlePluginPortal()
    }
}
```

2. В файле **build.gradle** в блок *plugins* добавить запись
```
id 'plugin.gradle.git.incTags' version '1.0'
```

4. Обновите проект

5. Во вкладке Gradle в разделе **Tasks** появится новый пакет задач *git tags* 

## git tags
Пакет содержит следующие задачи:

* **checkGitIsInstalled** 
	- задача проверяет установлен ли в системе Git
	- в случае отсутствия, в лог выводится сообщение о необходимость установки git и все остальные задачи пропускаются
	
* **checkCommitExistInRepo**
	- задача проверяет есть в системе зафиксированные изменения 
	- в случае отсутствия в лог выводится сообщение о том, что тег не может быть определен и присвоен, все остальные задачи пропускаются
	
* **checkLastCommitHaveTag**
	- задача проверяет присвоен ли текущему коммиту тег
	- в случае, если текущему состоянию уже присвоен тег, то новый тег не присваивается, в лог выводится соответствующее сообщение и последующие задачи defineNextVersion и assignNewVersion пропускаются

* **defineLastVersion**
	- задача определяет последнюю опубликованную версию
	- соответствующее сообщение выводится в лог
	
* **checkUncommittedFiles** 
	- задача проверяет если ли в рабочей директории незакомиченные изменения, подсчитывает их и выводит в лог сообщение с указанием последней версии сборки и количества незакомиченных изменений
	- в случен наличия незакомиченных изменений в рабочей директории присвоение нового тега невозможно

	
    ***Примечание:*** для корректного подсчета незакомиченных изменений необходимо установить следующую глобальную настройку для git:
    ```
  git config --global status.showuntrackedfiles all
    ```

* **defineCurrentBranch**
	- задача определяет текущую ветку и выводит соответствующее сообщение в лог

* **defineNextVersion**
	- задача определяет следующую версию билда исходя из следующих условий:
 
		1. *dev/qa* - инкремент минорной версии
 		2. *stage* - добавить постфикс -rc
  		3.  *master* - инкремент мажорной версии
  		4.  *любая другая ветка* - постфикс -SNAPSHOT
  	   
	- соответствующее сообщение выводится в лог
	
* **assignNewVersion**
	- задача присваивает новый git tag в локальном репозитории
	- соответствующее сообщение выводится в лог
	
* **publishNewVersion**
	- задача публикует новый тег в закрепленный удаленный репозиторий
	- задача запускается только при успешном завершении задачи assignNewVersion
